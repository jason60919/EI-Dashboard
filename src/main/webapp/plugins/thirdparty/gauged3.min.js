GaugeD3=function(e){"use strict";function t(e){if(D.bindto=e.bindto,D.title.text=e.title.text,D.title.color=e.title.color,e.value.min>e.value.max){var t=e.value.max;e.value.max=e.value.min,e.value.min=t}e.value.min===e.value.max&&(e.value.max=e.value.min+100),D.value.val=Number(e.value.val),D.value.color=e.value.color,D.value.min=Number(e.value.min),D.value.max=Number(e.value.max),D.value.metricPrefix=e.value.metricPrefix,D.value.metricPrefixDecimal=Number(e.value.metricPrefixDecimal),D.value.hide=e.value.hide,D.value.hideMinMax=e.value.hideMinMax,D.value.metricPrefixMinMax=e.value.metricPrefixMinMax,D.value.decimals=Number(e.value.decimals),D.value.commma=e.value.commma,D.value["class"]=e.value["class"],D.gauge.widthScale=Math.max(0,Math.min(Number(e.gauge.widthScale),1)),D.gauge.color=e.gauge.color,D.gauge.noGradient=e.gauge.noGradient,D.gauge.type=e.gauge.type,-1===_.indexOf(T,D.gauge.type)&&(D.gauge.type=T[0]),D.gauge.donut.startAngle=Math.max(0,Math.min(Number(e.gauge.donut.startAngle),359)),D.label.text=e.label.text,D.label.color=e.label.color,D.label["class"]=e.label["class"],D.level.colors=e.level.colors,D.level.counter=e.level.counter,D.level.customSectors=e.level.customSectors,D.transition.startTime=Number(e.transition.startTime),D.transition.startType=e.transition.startType,D.transition.refreshTime=Number(e.transition.refreshTime),D.transition.refreshType=e.transition.refreshType,D.value.val=l(D.value.val)}function a(e){return"translate("+e.width/2+","+e.height/2+")"}function r(e){var t,a,r;return e.width>e.height?(t=e.height,a=1.25*t,a>e.width&&(r=a/e.width,a/=r,t/=r)):e.width<e.height?(a=e.width,t=a/1.25,t>e.height&&(r=a/e.height,t/=r,width=t/r)):(a=e.width,t=.75*a),{height:t,width:a}}function i(e){var t;switch(D.gauge.type){case"threequarter-left-top":case"threequarter-right-top":case"threequarter-left-bottom":case"threequarter-right-bottom":case"threequarter-bottom":t=Math.floor(Math.min(e.width,e.height)/N);break;case"donut":t=Math.floor(Math.min(e.width,e.height)/F);break;case"half":t=Math.floor(Math.min(e.width,e.height)/z);break;case"quarter-left-top":case"quarter-right-top":case"quarter-left-bottom":case"quarter-right-bottom":t=Math.floor(Math.min(e.width,e.height)/P)}return t}function l(e){return Math.max(D.value.min,Math.min(D.value.max,e))}function n(e){var t,a,r=Math.PI/2;switch(D.gauge.type){case"half":C.startArcAngle=-r,a=r;break;case"donut":C.startArcAngle=D.gauge.donut.startAngle*w,a=360*w+C.startArcAngle;break;case"quarter-left-top":C.startArcAngle=-r,a=0;break;case"quarter-right-top":C.startArcAngle=0,a=r;break;case"quarter-left-bottom":C.startArcAngle=Math.PI,a=3*r;break;case"quarter-right-bottom":C.startArcAngle=r,a=Math.PI;break;case"threequarter-left-top":C.startArcAngle=0,a=3*r;break;case"threequarter-right-top":C.startArcAngle=r,a=360*w;break;case"threequarter-left-bottom":C.startArcAngle=-r,a=Math.PI;break;case"threequarter-right-bottom":C.startArcAngle=-Math.PI,a=r;break;case"threequarter-bottom":C.startArcAngle=-Math.PI+r/2,a=r+r/2}return t=d3.svg.arc().innerRadius(e-c(e)).outerRadius(e).startAngle(C.startArcAngle).endAngle(a)}function o(e,t){return"translate("+e+","+t+")"}function m(e,t,a,r){var i,l=t.insert("path","text").style("fill",r).attr("d",a),n=Math.floor(e/2);switch(D.gauge.type){case"half":i=o(0,n);break;case"quarter-left-top":i=o(n,n);break;case"quarter-right-top":i=o(-1*n,n);break;case"quarter-left-bottom":i=o(n,-1*n);break;case"quarter-right-bottom":i=o(-1*n,-1*n)}return l.attr("transform",i),l}function u(e){var t,a,r,i,l={title:{fontsize:"",dy:"",x:0},value:{fontsize:"",dy:"",x:0},label:{fontsize:"",dy:"",x:0},minmax:{fontsize:"",min_dy:"",max_dy:"",min_x:0,max_x:0}};switch(D.gauge.type){case"half":l.title.fontsize=(1.3*e/M).toFixed(2)+"em",l.value.fontsize=(2.2*e/M).toFixed(2)+"em",l.label.fontsize=(.9*e/M).toFixed(2)+"em",l.minmax.fontsize=(.9*e/M).toFixed(2)+"em",l.title.dy="-4.5em",l.value.dy="1.7em",l.label.dy="5.9em",l.minmax.min_dy=l.minmax.max_dy="5.9em",t=e-c(e)/2,l.minmax.min_x=-t,l.minmax.max_x=t;break;case"donut":l.title.fontsize=(1.3*e/M).toFixed(2)+"em",l.value.fontsize=(2.2*e/M).toFixed(2)+"em",l.label.fontsize=(.9*e/M).toFixed(2)+"em",l.minmax.fontsize=(.9*e/M).toFixed(2)+"em",l.value.dy=".3em",l.label.dy="2.3em",l.title.dy="-1.3em",l.minmax.min_dy=l.minmax.max_dy="7.5em",t=e,l.minmax.min_x=-t,l.minmax.max_x=t;break;case"threequarter-left-top":case"threequarter-right-top":case"threequarter-left-bottom":case"threequarter-right-bottom":case"threequarter-bottom":switch(l.title.fontsize=(1.3*e/M).toFixed(2)+"em",l.label.fontsize=(.9*e/M).toFixed(2)+"em",l.value.fontsize=(2.2*e/M).toFixed(2)+"em",l.minmax.fontsize=(.9*e/M).toFixed(2)+"em",l.value.dy=".1em",l.label.dy="1.8em",t=e-c(e)/2,D.gauge.type){case"threequarter-left-top":l.title.dy="-2.8em",l.minmax.max_dy="-0.6em",l.title.x=-e/1.5,l.minmax.max_x=-t;break;case"threequarter-right-top":l.title.dy="-2.8em",l.minmax.min_dy="-0.6em",l.title.x=e/1.5,l.minmax.min_x=t;break;case"threequarter-left-bottom":l.title.dy="3.5em",l.minmax.min_dy="1.3em",l.title.x=-e/1.5,l.minmax.min_x=-t;break;case"threequarter-right-bottom":l.title.dy="3.5em",l.minmax.max_dy="1.3em",l.title.x=e/1.5,l.minmax.max_x=t;break;case"threequarter-bottom":l.title.dy="-1.3em",l.value.dy=".3em",l.label.dy="2.2em",l.minmax.min_dy=l.minmax.max_dy="7.8em",l.minmax.max_x=t-e/4,l.minmax.min_x=-t+e/4}break;case"quarter-left-top":case"quarter-right-top":case"quarter-left-bottom":case"quarter-right-bottom":switch(l.title.fontsize=(1.3*e/k).toFixed(2)+"em",l.value.fontsize=(2.5*e/k).toFixed(2)+"em",l.label.fontsize=(.9*e/k).toFixed(2)+"em",l.minmax.fontsize=(.9*e/k).toFixed(2)+"em",a=e/2.3,t=e/3,i=e/2,r=i-c(e)/2,D.gauge.type){case"quarter-left-top":l.title.dy="-5em",l.value.dy="1.9em",l.label.dy="7em",l.minmax.min_dy="8.7em",l.minmax.max_dy="-7.9em",l.title.x=-a,l.value.x=t,l.label.x=t,l.minmax.min_x=-r,l.minmax.max_x=i;break;case"quarter-right-top":l.title.dy="-5em",l.value.dy="1.9em",l.label.dy="7em",l.minmax.min_dy="-7.9em",l.minmax.max_dy="8.7em",l.title.x=a,l.value.x=-t,l.label.x=-t,l.minmax.min_x=-i,l.minmax.max_x=r;break;case"quarter-left-bottom":l.title.dy="5em",l.value.dy="-1.7em",l.label.dy="-3.1em",l.minmax.min_dy="8.7em",l.minmax.max_dy="-7.9em",l.title.x=-a,l.value.x=t,l.label.x=t,l.minmax.min_x=i,l.minmax.max_x=-r;break;case"quarter-right-bottom":l.title.dy="5em",l.value.dy="-1.7em",l.label.dy="-3.1em",l.minmax.min_dy="-7.9em",l.minmax.max_dy="8.7em",l.title.x=a,l.value.x=-t,l.label.x=-t,l.minmax.min_x=r,l.minmax.max_x=-i}}return l}function s(e){if(D.value.hideMinMax!==!0){var t,a,r,i;switch(i=6*e/M,D.gauge.type){case"threequarter-left-top":t=C.min.node().getBBox(),r=e-c(e)/2-t.height/4,a=t.width/2+i,C.min.attr("transform",o(-1*a,-1*r));break;case"threequarter-right-top":t=C.max.node().getBBox(),r=e-c(e)/2-t.height/4,a=t.width/2+i,C.max.attr("transform",o(a,-1*r));break;case"threequarter-left-bottom":t=C.max.node().getBBox(),r=e-c(e)/2+t.height/4,a=t.width/2+i,C.max.attr("transform",o(-1*a,r));break;case"threequarter-right-bottom":t=C.min.node().getBBox(),r=e-c(e)/2+t.height/4,a=t.width/2+i,C.min.attr("transform",o(a,r))}}}function c(e){return Math.floor(D.gauge.widthScale*(e/2.5))}function x(e,t){var a=function(e){return"#"===e.charAt(0)?e.substring(1,7):e};if(D.level.customSectors.length>0){var r=_.findIndex(D.level.customSectors,function(t){return e>t.lo&&e<=t.hi});if(r>=0)return D.level.customSectors[r].color}var i=D.level.colors.length;if(1===i)return D.level.colors[0];for(var l=D.gauge.noGradient?1/i:1/(i-1),n=[],o=0;i>o;o++)n.push({percentage:D.gauge.noGradient?l*(o+1):l*o,color:{r:parseInt(a(D.level.colors[o]).substring(0,2),16),g:parseInt(a(D.level.colors[o]).substring(2,4),16),b:parseInt(a(D.level.colors[o]).substring(4,6),16)}});if(0===t)return"rgb("+[n[0].color.r,n[0].color.g,n[0].color.b].join(",")+")";for(var m,u,s,c,x,d,h,g=0;g<n.length;g++)if(t<=n[g].percentage)return D.gauge.noGradient?"rgb("+[n[g].color.r,n[g].color.g,n[g].color.b].join(",")+")":(d=n[g-1],h=n[g],m=h.percentage-d.percentage,u=(t-d.percentage)/m,s=1-u,c=u,x={r:Math.floor(d.color.r*s+h.color.r*c),g:Math.floor(d.color.g*s+h.color.g*c),b:Math.floor(d.color.b*s+h.color.b*c)},"rgb("+[x.r,x.g,x.b].join(",")+")")}function d(e){if(!_.isNumber(e))return 0;var t;if(D.value.metricPrefix){var a=d3.formatPrefix(e);t=a.scale(e).toFixed(D.value.metricPrefixDecimal)+a.symbol}else{var r;r=d3.format(D.value.comma===!0?",."+D.value.decimal+"f":"."+D.value.decimal+"f"),t=r(e)}return t}function h(){var e;if(D.value.metricPrefix){var t=d3.formatPrefix(D.value.min);e=t.scale(D.value.min).toFixed(D.value.metricPrefixDecimal)+t.symbol}else{var a;a=d3.format(D.value.comma===!0?",."+D.value.decimal+"f":"."+D.value.decimal+"f"),e=a(D.value.min)}return e}function g(){var e;if(D.value.metricPrefix){var t=d3.formatPrefix(D.value.max);e=t.scale(D.value.max).toFixed(D.value.metricPrefixDecimal)+t.symbol}else{var a;a=d3.format(D.value.comma===!0?",."+D.value.decimal+"f":"."+D.value.decimal+"f"),e=a(D.value.max)}return e}function f(){var e=A.getBoundingClientRect();C.svg=d3.select("#"+D.bindto).append("svg").attr("width",e.width).attr("height",e.height),C.gCenter=C.svg.append("g").style("opacity",0).attr("transform",a(e)),I=r(e);var t=i(I);C.arc=n(t),m(t,C.gCenter,C.arc,D.gauge.color),C.arc_level=m(t,C.gCenter,C.arc,x(D.value.val,0)),C.curArcAngle=C.startArcAngle,C.scale_per=d3.scale.linear().domain([D.value.min,D.value.max]).range([0,1]);var l=u(t);""!==D.title.text&&C.gCenter.append("text").text(D.title.text).style("fill",D.title.color).style("text-anchor","middle").attr("dy",l.title.dy).attr("x",l.title.x).attr("font-size",l.title.fontsize).attr("class",D.title["class"]),D.value.hide===!1&&(C.value=C.gCenter.append("text").data([{value:D.value.val}]).text(d()).style("fill",D.value.color).style("text-anchor","middle").attr("dy",l.value.dy).attr("x",l.value.x).attr("font-size",l.value.fontsize).attr("class",D.value["class"]),C.label=C.gCenter.append("text").text(D.label.text).style("fill",D.label.color).style("text-anchor","middle").attr("dy",l.label.dy).attr("x",l.label.x).attr("font-size",l.label.fontsize).attr("class",D.label["class"])),D.value.hideMinMax===!1&&(C.min=C.gCenter.append("text").text(h()).style("fill",D.label.color).style("text-anchor","middle").attr("dy",l.minmax.min_dy).attr("x",l.minmax.min_x).attr("font-size",l.minmax.fontsize).attr("class",D.value["class"]),C.max=C.gCenter.append("text").text(g()).style("fill",D.label.color).style("text-anchor","middle").attr("dy",l.minmax.max_dy).attr("x",l.minmax.max_x).attr("font-size",l.minmax.fontsize).attr("class",D.value["class"])),s(t)}function v(){if(!_.isNull(C.svg)){var e=A.getBoundingClientRect(),t=r(e);C.svg.attr("height",e.height).attr("width",e.width);var i=t.width/I.width,l=t.height/I.height;C.gCenter.attr("transform",a(e)+",scale("+i+", "+l+")")}}function b(){C.gCenter.transition().duration(D.transition.startTime).ease(D.transition.startType).style("opacity",1)}function y(e){C.value.transition().duration(D.transition.refreshTime).ease(D.transition.refreshType).tween("text",function(t){var a=d3.interpolate(t.value,e);return t.value=e,function(e){this.textContent=d(a(e))}})}function p(e){var t=C.scale_per(e),a=x(e,t),r=function(e){var t,a=function(e,t,a){return(t*e+a)*w};switch(D.gauge.type){case"half":t=a(e,180,-90);break;case"donut":t=a(e,360,D.gauge.donut.startAngle);break;case"quarter-left-top":t=a(e,90,-90);break;case"quarter-right-top":t=a(e,90,0);break;case"quarter-left-bottom":t=a(e,90,180);break;case"quarter-right-bottom":t=a(e,90,90);break;case"threequarter-left-top":t=a(e,270,0);break;case"threequarter-right-top":t=a(e,270,90);break;case"threequarter-left-bottom":t=a(e,270,-90);break;case"threequarter-right-bottom":t=a(e,270,-180);break;case"threequarter-bottom":t=a(e,270,-135)}return t}(t);C.arc_level.datum(r),C.arc_level.transition().duration(D.transition.refreshTime).ease(D.transition.refreshType).style("fill",a).attrTween("d",function(e){var t=d3.interpolate(C.curArcAngle,e);return function(e){return C.curArcAngle=t(e),C.arc.endAngle(t(e))()}})}function q(e,t,a){_.isNull(C.svg)||_.isNumber(e)&&(D.value.hideMinMax===!1&&(_.isUndefined(t)||(D.value.min=t,C.min.datum(D.value.min).text(h())),_.isUndefined(a)||(D.value.max=a,C.max.datum(D.value.max).text(g()))),e=l(e),D.value.hide===!1&&(D.value.transition===!0?y(e):C.value.text(d(e))),p(e),D.value.val=e)}var A=null,M=112,k=Math.floor(1.66*M),w=Math.PI/180,z=2,P=1.3,F=2.15,N=2.15,T=["half","donut","quarter-left-top","quarter-right-top","quarter-left-bottom","quarter-right-bottom","threequarter-left-top","threequarter-right-top","threequarter-left-bottom","threequarter-right-bottom","threequarter-bottom"],C={svg:null,gCenter:null,arc:null,arc_level:null,scale_per:null,value:null,min:null,max:null,startArcAngle:0,curArcAngle:0},I={height:0,width:0},B={bindto:"",title:{text:"",color:"#999999","class":""},value:{val:0,color:"#010101",min:0,max:100,metricPrefix:!1,metricPrefixDecimal:0,hide:!1,hideMinMax:!1,metricPrefixMinMax:!1,decimals:0,comma:!1,transition:!0,"class":""},gauge:{widthScale:1,color:"#edebeb",noGradient:!1,type:"half",donut:{startAngle:0}},label:{text:"",color:"#edebeb","class":""},level:{colors:["#a9d70b","#f9c802","#ff0000"],counter:!1,customSectors:[]},transition:{startTime:700,startType:"linear",refreshTime:700,refreshType:"circle-out"}},D=B,G=function(e){return _.isNull(e)||_.isUndefined(e)?(console.error("GaugeD3: Make sure to pass options to the constructor!"),!1):_.isNull(e.bindto)||_.isUndefined(e.bindto)?(console.error("GaugeD3: No element with id : %s found",D.bindto),!1):(A=document.getElementById(e.bindto))?(t(_.merge(B,e)),f(),void b()):(console.error("GaugeD3: No element with id : %s found",e.bindto),!1)}(e);return G===!1?void 0:{resize:function(){v()},refresh:function(e,t,a){q(Number(e),t,a)},destroy:function(){_.isNull(C.svg)&&(C.gCenter.remove(),C.svg.remove())}}};